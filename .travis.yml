language: python

matrix:
    include:
        - os: osx
          python: "3.5"
          language: generic
          osx_image: xcode11
          env: PYTHON=3.5
        - os: osx
          python: "3.6"
          language: generic
          osx_image: xcode11
          env: PYTHON=3.6
        - os: osx
          python: "3.7"
          language: generic
          osx_image: xcode11
          env: PYTHON=3.7
        - os: linux
          python: "3.5"
          language: python
          cache: pip
        - os: linux
          python: "3.6"
          language: python
          cache: pip
        - os: linux
          dist: xenial
          python: "3.7"
          language: python
          cache: pip   



before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
    brew install swig;
    brew install ffmpeg;
    brew install unzip;
    curl -LO https://raw.githubusercontent.com/GiovanniBussi/macports-ci/master/macports-ci;
    source ./macports-ci install;
    yes | sudo port install python$PYTHON;
    yes | sudo port install py$PYTHON-pip;
    sudo port select --set python3 python$PYTHON;
    sudo port select --set pip pip$PYTHON;
    python3 --version;
    pip --version;
    export PATH=$PATH:$(python3 -c "import site; print(site.USER_BASE)")/bin;
    fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
    sudo add-apt-repository ppa:jonathonf/ffmpeg-4 -y;
    sudo apt-get update -q;
    sudo apt-get install ffmpeg unzip wget -y;
    sudo apt-get install dos2unix -y;
    dos2unix scripts/bash/prepare_dataset.sh;
    chmod +x scripts/bash/prepare_dataset.sh;
    dos2unix scripts/bash/install_opencv.sh;
    chmod +x scripts/bash/install_opencv.sh;
    fi

branches: 
  only: 
    - testing

install: 
  - "pip install --upgrade pip wheel --user"
  - "pip install --upgrade numpy --user"
  - "pip install . --user"
  - "pip uninstall opencv-contrib-python -y --user"
  - "pip install six --user"
  - "pip install --upgrade pytest --user"
  - "pip install --upgrade youtube-dl --user"

before_script:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
    source ./scripts/bash/prepare_dataset.sh;
    fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
    bash scripts/bash/install_opencv.sh;
    bash scripts/bash/prepare_dataset.sh;
    fi

script:
  - python -m pytest -sv
